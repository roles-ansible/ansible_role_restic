[Unit]
Description=Backup {{ item.name }} using restic
{% if item.lvm is defined %}
Conflicts=fstrim.service
After=fstrim.timer
{% endif %}

[Service]
Type=oneshot
{% if item.lvm is defined %}
PrivateMounts=on
{% endif %}
{% if item.niceness is defined %}
Nice={{ item.niceness }}
{% endif %}
ExecStart={{ restic_script_dir }}/backup-{{ item.name }}.sh
TimeoutStartSec=0
User={{ restic_user }}
Environment="CRON=true"
